<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Triticale</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/png" />
    <script>
      const canvas = document.createElement('canvas');
      canvas.width = 16;
      canvas.height = 16;
      const context = canvas.getContext('2d');
      context.fillStyle = 'pink';

      context.fillRect(0, 0, 16, 16);

      const favicon = canvas.toDataURL('image/png');

      document.querySelector('link[rel="icon"]').setAttribute('href', favicon);

    </script>
  </head>
  <body>
    <synth-brain>
        <synth-section id="granulation" label="Granulation">
          <div class="synth-controls">
            <synth-dial name="grainDuration" min="1" max="1000" label="Duration"></synth-dial>
            <synth-dial name="density" min="1" max="128" label="Density"></synth-dial>
            <synth-dial name="window" min="1" max="10" label="Window" step="0.1"></synth-dial>
            <synth-dial name="spray" min="1" max="128" label="Spray" step="1"></synth-dial>
            <synth-dial name="random" min="0" max="1" step="0.25" label="Random" format="percent"></synth-dial>
          </div>
        </synth-section>
        <section id="transport">
          <latch-button></latch-button>
          <div class="glitch-controls">
            <synth-switch name="glitch.active" label="Glitch"></synth-switch>
            <synth-dial name="glitch.rate" min="0" max="10" step="1" label="Glitch rate"></synth-dial>
            <synth-dial name="glitch.overlays" min="1" max="8" step="1" label="Ghosts"></synth-dial>
            <div class="ghost-indicator" aria-live="polite">Ghosts: 0</div>
          </div>
        </section>
        <synth-display></synth-display>
        <synth-waveform></synth-waveform>
        <synth-section id="effects" label="Effects">
          <synth-segmented
            slot="heading-action"
            name="effectsChainMode"
            options='[{"value":"series","label":"Linear"},{"value":"parallel","label":"Parallel"}]'
          ></synth-segmented>
          <div class="synth-effects">
            <div class="synth-effect">
              <synth-switch name="effects.bitcrusher.active" label="Bitcrusher"></synth-switch>
              <div class="synth-controls">
                <synth-dial name="effects.bitcrusher.bits" min="0" max="16" step="4" label="Bits"></synth-dial>
                <synth-dial name="effects.bitcrusher.normfreq" min="0.0001" max="1" step="0.001" label="Norm Freq"></synth-dial>
              </div>
            </div>
            <div class="synth-effect">
              <synth-switch name="effects.delay.active" label="Delay"></synth-switch>
              <div class="synth-controls">
                <synth-dial name="effects.delay.feedback" min="0" max="1" step="0.01" label="Feedback"></synth-dial>
                <synth-dial name="effects.delay.time" min="0" max="1" step="0.01" label="Time"></synth-dial>
                <synth-dial name="effects.delay.mix" min="0" max="1" step="0.01" label="Mix"></synth-dial>
              </div>
            </div>
            <div class="synth-effect">
              <div class="section-heading">
                <synth-switch name="effects.biquad.active" label="Filter"></synth-switch>
                <synth-select
                  name="effects.biquad.type"
                  options='[{"value": "lowpass", "label": "Lowpass"}, {"value": "highpass", "label": "Highpass"}, {"value": "bandpass", "label": "Bandpass"}]'
                ></synth-select>
              </div>
              <div class="synth-controls">
                <synth-dial name="effects.biquad.biquadFrequency" min="20" max="22050" step="1" label="Frequency"></synth-dial>
                <synth-dial name="effects.biquad.quality" min="0" max="20" step="0.1" label="Quality"></synth-dial>
                <synth-dial name="effects.biquad.randomValues" min="0" max="100" step="1" label="Random"></synth-dial>
              </div>
            </div>
          </div>
        </synth-section>
        <section id="joystick">
          <synth-joystick name="effects.detune.value" min="-1200" max="1200" label="Pitch"></synth-joystick>
        </section>
        <section id="ribbon">
          <synth-ribbon></synth-ribbon>
        </section>
        <div id="logo">
          <img src="./logo.png" id="synth-logo" alt="Triticale logo" />
        </div>
    </synth-brain>
    <script type="importmap">
      {
        "imports": {
          "helpers/": "./helpers/"
        }
      }
    </script>
    <script type="module">
      import { setPublicPath } from "./helpers/setPublicPath.js";
      import { App } from "./App.js";

      setPublicPath(new URL("./", import.meta.url).href);
      App();
    </script>
  </body>
</html>
